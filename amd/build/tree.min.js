define ("tool_navdb/tree",["jquery","core/url","core/log","core/ajax"],function(a,b,c,d){var e=a("<img alt=\"\" src=\""+b.imageUrl("t/expanded")+"\"/>"),f=a("<img alt=\"\" src=\""+b.imageUrl("t/collapsed")+"\"/>"),g=function(b){this.elementRoot=a(b);this.treeRoot=this.elementRoot.find("[data-tree=root]");if(!this.treeRoot.data("treeinit")){this.items=this.treeRoot.find("li");this.expandAll=20>this.items.length;this.parents=this.treeRoot.find("li:has(ul)");this.items.attr("aria-selected","false");this.visibleItems=null;this.activeItem=null;this.lastActiveItem=null;this.filter=this.elementRoot.find("[data-tree=filter]");this.starrTogglers=this.elementRoot.find("[data-tree=startoggler]");this.starredDisplay=this.elementRoot.find("[data-tree=starred]");this.init();this.bindEventHandlers();this.treeRoot.data("treeinit","true")}};g.prototype.init=function(){this.parents.attr("aria-expanded","true");this.parents.prepend(e.clone());this.items.attr("role","tree-item");this.items.attr("tabindex","-1");this.parents.attr("role","group");this.treeRoot.attr("role","tree");this.visibleItems=this.treeRoot.find("li");var b=this;if(!this.expandAll){this.parents.each(function(){b.collapseGroup(a(this))})}this.starrTogglers.show();this.updateStarredElements()};g.prototype.updateStarredElements=function(){var b=this,c=b.starredDisplay.find("ul");c.html("");var d=0;this.treeRoot.find(".starred").each(function(b,e){var f=a(e).clone();f.find("[data-tree=startoggler]").remove();c.append(f);d++});if(0<d){b.starredDisplay.show()}else{b.starredDisplay.hide()}};g.prototype.expandGroup=function(a){var b=a.children("ul");b.show().attr("aria-hidden","false");a.attr("aria-expanded","true");a.children("img").attr("src",e.attr("src"));this.visibleItems=this.treeRoot.find("li:visible")};g.prototype.collapseGroup=function(a){var b=a.children("ul");b.hide().attr("aria-hidden","true");a.attr("aria-expanded","false");a.children("img").attr("src",f.attr("src"));this.visibleItems=this.treeRoot.find("li:visible")};g.prototype.toggleGroup=function(a){if("true"==a.attr("aria-expanded")){this.collapseGroup(a)}else{this.expandGroup(a)}};g.prototype.toggleItem=function(a){var b=a.attr("aria-selected");if("true"===b){b="false"}else{b="true"}a.attr("aria-selected",b)};g.prototype.on=function(a,b){if("selectionchanged"!==a){c.warning("Invalid custom event name for tree. Only \"selectionchanged\" is supported.")}else{this.treeRoot.on(a,b)}};g.prototype.handleDblClick=function(a,b){this.toggleGroup(a);b.stopPropagation();return!1};g.prototype.handleExpandCollapseClick=function(a,b){this.toggleGroup(a);b.stopPropagation();return!1};g.prototype.handleFilter=function(b){var c=this,d=this.filter.val();if(""==d){this.items.each(function(){a(this).show()});this.parents.each(function(){a(this).show();c.collapseGroup(a(this))})}else{this.items.each(function(){if(-1!=a(this).text().indexOf(d)){a(this).show()}else{a(this).hide()}});this.parents.each(function(){c.expandGroup(a(this))})}b.stopPropagation();return!1};g.prototype.handleStarredClick=function(a,b){var c=this,e=a.data("tablename"),f=a.parents(".dbtable");if(e!=void 0){d.call([{methodname:"tool_navdb_starred_table",args:{table:e},done:function done(a){if(!0==a.success){f.toggleClass("starred");c.updateStarredElements()}},fail:function fail(a){c.lastexception=a}}])}if(b!=void 0){b.stopPropagation()}return!1};g.prototype.bindEventHandlers=function(){var b=this;this.parents.dblclick(function(c){return b.handleDblClick(a(this),c)});this.items.children("img").click(function(c){return b.handleExpandCollapseClick(a(this).parent(),c)});this.filter.keyup(function(a){return b.handleFilter(a)});this.starrTogglers.click(function(c){return b.handleStarredClick(a(this),c)})};return g});
//# sourceMappingURL=tree.min.js.map

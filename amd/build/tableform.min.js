define ("tool_navdb/tableform",["jquery","core/url","core/log","core/ajax"],function(a,b,c,d){var e=a("<span class=\"filterview\">...</span>"),f={},g={},h=function(b){this.elementRoot=a(b);if(!this.elementRoot.data("tableforminit")){this.fields=this.elementRoot.find(".tablefields input");this.filter=this.elementRoot.find("[data-formuse=filtervalue]");this.operands=this.elementRoot.find("select");this.submitbutton=this.elementRoot.find("input[type=\"submit\"]");this.init();this.bindEventHandlers();this.elementRoot.data("tableforminit","true")}};h.prototype.init=function(){var b=this;this.filterview=e.clone();this.filterview.attr("id","filterview");this.filter.after(this.filterview);this.filter.hide();var c=[];this.fields.each(function(){var d=a(this),f=d.data("helper");if(f!=void 0&&"undefined"!=f){var g=e.clone();g.attr("id","helperview_"+d.attr("name"));d.after(g);var h=d.clone();h.attr("id","helper_"+d.attr("name"));h.attr("name","helper_"+d.attr("name"));h.data("helps",d.attr("name"));h.keyup(function(c){return b.handleHelperChange(a(this),c)});d.after(h);c.push(h);b.handleHelperChange(h);d.hide()}});this.helpers=c};h.prototype.getSQL=function(b){var c=b.val();if(""==c){return""}var d=b.attr("id").replace("fld_",""),e=a("#op_"+d+" option:selected"),h=e.data("transform"),i=e.data("clause");if(h==void 0){h="none"}if(f[h]!=void 0){var j=f[h];if(!j(c)){return}}if(g[h]!=void 0){var j=g[h];c=j(c)}return i.replace("VAL",c)};h.prototype.updateFilter=function(){var b=this,c=[],d="";b.fields.each(function(){var e=a(this),f=b.getSQL(e);e.removeClass("inputerror");a("#helper_"+e.attr("name")).removeClass("inputerror");if(f==void 0){e.addClass("inputerror");a("#helper_"+e.attr("name")).addClass("inputerror");d="Invalid value: "+e.attr("id").replace("fld_","")}if(""!=f){c.push(f)}});if(""!=d){b.lastexception=d;b.filter.val("")}else{var e=c.join(" AND ");if(""==e){b.filter.val("")}else{b.filter.val(e)}}this.filterview.html(b.filter.val());if(""==b.filter.val()){this.submitbutton.attr("disabled",!0)}else{this.submitbutton.removeAttr("disabled")}};h.prototype.updateHelperValue=function(b,c){var d=this,e=a("#fld_"+c),f=a("#helper_"+c),g=a("#helperview_"+c);g.html(b.human);if(b.success==void 0||!1==b.success){e.val(f.val())}else{e.val(b.newvalue)}d.updateFilter()};h.prototype.handleFieldChange=function(a,b){var c=this;c.updateFilter();b.stopPropagation();return!1};h.prototype.handleFormSubmit=function(a,b){var c=this;if(""==c.filter.val()){b.preventDefault();return!1}return!0};h.prototype.handleHelperChange=function(a,b){var c=this,e=a.val(),f=a.data("helper"),g=a.data("helps");if(g!=void 0&&f!=void 0){d.call([{methodname:"tool_navdb_get_"+f,args:{value:e},done:function done(a){c.updateHelperValue(a,g)},fail:function fail(a){c.updateHelperValue({success:!1,newvalue:e,human:"Error",warnings:[a]},g)}}])}if(b!=void 0){b.stopPropagation()}return!1};h.prototype.bindEventHandlers=function(){var b=this;this.elementRoot.submit(function(c){return b.handleFormSubmit(a(this),c)});this.fields.keyup(function(c){return b.handleFieldChange(a(this),c)});this.operands.change(function(c){return b.handleFieldChange(a(this),c)})};f.none=function(){return!0};f.addslashes=function(){return!0};f.integer=function(b){var c=Number.isInteger(parseInt(b)),d=a.isNumeric(b),e=/^[0-9]+$/.test(b);return c&&d&&e};f.numeric=function(b){return a.isNumeric(b)};f.none_array=function(){return!0};f.addslashes_array=function(){return!0};f.integer_array=function(a){for(var b=a.split(","),c=0;c<b.length;c++){if(""==b[c]){continue}if(!f.integer(b[c])){return!1}}return!0};f.numeric_array=function(a){for(var b=a.split(","),c=0;c<b.length;c++){if(""==b[c]){continue}if(!f.numeric(b[c])){return!1}}return!0};g.none=function(a){return a};g.addslashes=function(a){var b=a.replace(/'/g,"\\'");return"'"+b+"'"};g.integer=function(a){return a};g.numeric=function(a){var b=parseFloat(a);return b.toString()};g.none_array=function(a){for(var b=a.split(","),c=[],d=0;d<b.length;d++){if(""==b[d]){continue}c.push(g.none(b[d]))}return c.join(",")};g.addslashes_array=function(a){for(var b=a.split(","),c=[],d=0;d<b.length;d++){if(""==b[d]){continue}c.push(g.addslashes(b[d]))}return c.join(",")};g.integer_array=function(a){for(var b=a.split(","),c=[],d=0;d<b.length;d++){if(""==b[d]){continue}c.push(g.integer(b[d]))}return c.join(",")};g.numeric_array=function(a){for(var b=a.split(","),c=[],d=0;d<b.length;d++){if(""==b[d]){continue}c.push(g.numeric(b[d]))}return c.join(",")};return h});
//# sourceMappingURL=tableform.min.js.map

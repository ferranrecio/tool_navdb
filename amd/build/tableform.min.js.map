{"version":3,"sources":["../src/tableform.js"],"names":["define","$","url","log","ajax","filterdview","fieldcheck","fieldtransform","Tableform","rootselector","elementRoot","data","fields","find","filter","operands","submitbutton","init","bindEventHandlers","prototype","thisObj","filterview","clone","attr","after","hide","helperitems","each","item","helper","newview","newinput","keyup","e","handleHelperChange","push","helpers","getSQL","value","val","atrname","replace","opitem","transform","clause","func","updateFilter","filtervalues","filterror","fldsql","removeClass","addClass","lastexception","filtersql","join","html","removeAttr","updateHelperValue","response","helps","input","label","human","success","newvalue","handleFieldChange","stopPropagation","handleFormSubmit","preventDefault","call","methodname","args","done","fail","ex","warnings","submit","change","none","addslashes","integer","ch1","Number","isInteger","parseInt","ch2","isNumeric","ch3","test","numeric","none_array","addslashes_array","integer_array","parts","split","i","length","numeric_array","res","fl","parseFloat","toString"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Implement a records dinamic table with column deletion buttons\n *\n * @module     tool_lp/tableform\n * @package    core\n * @copyright  2019 Ferran Recio Calder√≥\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['jquery', 'core/url', 'core/log', 'core/ajax'], function($, url, log, ajax) {\n    // Private variables and functions.\n    /** @var {String} undohide The html for undoing column hide */\n    var filterdview = $('<span class=\"filterview\">...</span>');\n    var fieldcheck = {};\n    var fieldtransform = {};\n\n    /**\n     * Constructor\n     *\n     * @param {String} selector\n     */\n    var Tableform = function(rootselector) {\n        this.elementRoot = $(rootselector);\n        if (!this.elementRoot.data('tableforminit')) {\n            this.fields = this.elementRoot.find('.tablefields input');\n            this.filter = this.elementRoot.find('[data-formuse=filtervalue]');\n            this.operands = this.elementRoot.find('select');\n            this.submitbutton = this.elementRoot.find('input[type=\"submit\"]');\n            this.init();\n\n            this.bindEventHandlers();\n            this.elementRoot.data('tableforminit','true');\n        }\n    };\n    // Public variables and functions.\n\n    /**\n     * Init this tree\n     * @method init\n     */\n    Tableform.prototype.init = function() {\n        var thisObj = this;\n        // add filter show\n        this.filterview = filterdview.clone();\n        this.filterview.attr('id', 'filterview');\n        this.filter.after(this.filterview);\n        this.filter.hide();\n        // add helpers\n        var helperitems = [];\n        this.fields.each(function() {\n            var item = $(this);\n            var helper = item.data('helper');\n            if ( helper != undefined && helper != 'undefined') {\n                var newview = filterdview.clone();\n                newview.attr('id', 'helperview_'+item.attr('name'));\n                item.after(newview);\n                var newinput = item.clone();\n                newinput.attr('id', 'helper_'+item.attr('name'));\n                newinput.attr('name', 'helper_'+item.attr('name'));\n                newinput.data('helps', item.attr('name'));\n                newinput.keyup(function(e) {\n                    return thisObj.handleHelperChange($(this),e);\n                });\n                item.after(newinput);\n                helperitems.push(newinput);\n                thisObj.handleHelperChange(newinput);\n                item.hide();\n            }\n        });\n        this.helpers = helperitems;\n    };\n\n    /**\n     * return an element SQL clause\n     * @method init\n     * @return {string} or undefined if it's not valid\n     */\n    Tableform.prototype.getSQL = function(item) {\n        var value = item.val();\n        if (value == '') {\n            return '';\n        }\n        var atrname = item.attr('id').replace('fld_','');\n        var opitem = $('#op_'+atrname+' option:selected');\n        var transform = opitem.data('transform');\n        var clause = opitem.data('clause');\n        if (transform == undefined) {\n            transform = 'none';\n        }\n        // check if its a valir value\n        if (fieldcheck[transform] != undefined) {\n            var func = fieldcheck[transform];\n            if (!func(value)) {\n                return;\n            }\n            //if (!fieldcheck[transform](value)) return;\n        }\n        if (fieldtransform[transform] != undefined) {\n            //value = fieldtransform[transform](value)) return;\n            var func = fieldtransform[transform];\n            value = func(value);\n        }\n        return clause.replace('VAL',value);\n    };\n\n    Tableform.prototype.updateFilter = function() {\n        var thisObj = this;\n        var filtervalues = [];\n        var filterror = '';\n        thisObj.fields.each(function() {\n            var item = $(this);\n            var fldsql = thisObj.getSQL(item);\n            item.removeClass('inputerror');\n            $('#helper_'+item.attr('name')).removeClass('inputerror');\n            if (fldsql == undefined) {\n                item.addClass('inputerror');\n                $('#helper_'+item.attr('name')).addClass('inputerror');\n                filterror = 'Invalid value: '+item.attr('id').replace('fld_','');\n            }\n            if (fldsql != '') {\n                filtervalues.push(fldsql);\n            }\n        });\n        // update filter input\n        if (filterror != '') {\n            thisObj.lastexception = filterror;\n            thisObj.filter.val('');\n        } else {\n            var filtersql = filtervalues.join(' AND ');\n            if (filtersql == '') {\n                thisObj.filter.val('');\n            } else {\n                thisObj.filter.val(filtersql);\n            }\n        }\n        this.filterview.html(thisObj.filter.val());\n        // disable submit button\n        if (thisObj.filter.val() == '') {\n            this.submitbutton.attr(\"disabled\", true);\n        } else {\n            this.submitbutton.removeAttr(\"disabled\");\n        }\n    };\n\n    Tableform.prototype.updateHelperValue = function(response, helps) {\n        var thisObj = this;\n        var input = $('#fld_'+helps);\n        var helper = $('#helper_'+helps);\n        var label = $('#helperview_'+helps);\n        label.html(response.human);\n        if (response.success == undefined || response.success == false) {\n            // item.addClass('inputerror');\n            // helper.addClass('inputerror');\n            input.val(helper.val());\n        } else {\n            input.val(response.newvalue);\n        }\n        thisObj.updateFilter();\n    };\n\n    /**\n     * Handle a filter apply.\n     *\n     * @method handleClick\n     * @param {Object} filter is the jquery id of the filter element\n     * @param {Event} e The event.\n     * @return {Boolean}\n     */\n    Tableform.prototype.handleFieldChange = function(item, e) {\n        var thisObj = this;\n        thisObj.updateFilter();\n        e.stopPropagation();\n        return false;\n    };\n\n    /**\n     * Handle form submit.\n     *\n     * @method handleClick\n     * @param {Object} filter is the jquery id of the filter element\n     * @param {Event} e The event.\n     * @return {Boolean}\n     */\n    Tableform.prototype.handleFormSubmit = function(item, e) {\n        var thisObj = this;\n        if (thisObj.filter.val() == '') {\n            e.preventDefault();\n            return false;\n        }\n        return true;\n    };\n\n    /**\n     * Handle helper change.\n     *\n     * @method handleClick\n     * @param {Object} filter is the jquery id of the filter element\n     * @param {Event} e The event.\n     * @return {Boolean}\n     */\n    Tableform.prototype.handleHelperChange = function(item, e) {\n        var thisObj = this;\n        // call helper\n        var value = item.val();\n        var helper = item.data('helper');\n        var helps = item.data('helps');\n        if ( helps!=undefined && helper != undefined) {\n            ajax.call([{\n                    methodname: 'tool_navdb_get_'+helper,\n                    args: {value: value},\n                    done: function (response) {\n                        thisObj.updateHelperValue(response, helps);\n                    },\n                    fail: function (ex) {\n                        var response = {\n                            success: false,\n                            newvalue: value,\n                            human: 'Error',\n                            warnings: [ex],\n                        };\n                        thisObj.updateHelperValue(response, helps);\n                    }\n                }]);\n        }\n        // thisObj.updateFilter();\n        if (e != undefined) {\n            e.stopPropagation();\n        }\n        return false;\n    };\n\n    /**\n     * Bind the event listeners we require.\n     *\n     * @method bindEventHandlers\n     */\n    Tableform.prototype.bindEventHandlers = function() {\n        var thisObj = this;\n\n        this.elementRoot.submit(function(e) {\n            return thisObj.handleFormSubmit($(this), e);\n        });// event.preventDefault()\n\n        this.fields.keyup(function(e) {\n            return thisObj.handleFieldChange($(this), e);\n        });\n\n        this.operands.change(function(e) {\n            return thisObj.handleFieldChange($(this), e);\n        });\n    };\n\n    // ---- SQL checks ----\n\n    fieldcheck.none = function() {\n        return true;\n    };\n\n    fieldcheck.addslashes = function() {\n        return true;\n    };\n\n    fieldcheck.integer = function(value) {\n        var ch1 = Number.isInteger(parseInt(value));\n        var ch2 = $.isNumeric(value);\n        var ch3 = /^[0-9]+$/.test(value);\n        return ch1 && ch2 && ch3;\n    };\n\n    fieldcheck.numeric = function(value) {\n        return $.isNumeric(value);\n    };\n\n    fieldcheck.none_array = function() {\n        return true;\n    };\n\n    fieldcheck.addslashes_array = function() {\n        return true;\n    };\n\n    fieldcheck.integer_array = function(value) {\n        var parts = value.split(',');\n        for (var i=0; i < parts.length; i++) {\n            if (parts[i] == '') {\n                continue;\n            }\n            if (!fieldcheck.integer(parts[i])) {\n                return false;\n            }\n        }\n        return true;\n    };\n\n    fieldcheck.numeric_array = function(value) {\n        var parts = value.split(',');\n        for (var i=0; i < parts.length; i++) {\n            if (parts[i] == '') {\n                continue;\n            }\n            if (!fieldcheck.numeric(parts[i])) {\n                return false;\n            }\n        }\n        return true;\n    };\n\n    // ---- SQL tranform ----\n\n    fieldtransform.none = function(value) {\n        return value;\n    };\n\n    fieldtransform.addslashes = function(value) {\n        var res = value.replace(/'/g, \"\\\\'\");\n        return \"'\"+res+\"'\";\n    };\n\n    fieldtransform.integer = function(value) {\n        return value;\n    };\n\n    fieldtransform.numeric = function(value) {\n        var fl = parseFloat(value);\n        return fl.toString();\n    };\n\n    fieldtransform.none_array = function(value) {\n        var parts = value.split(',');\n        var res = [];\n        for (var i=0; i < parts.length; i++) {\n            if (parts[i] == '') {\n                continue;\n            }\n            res.push(fieldtransform.none(parts[i]));\n        }\n        return res.join(',');\n    };\n\n    fieldtransform.addslashes_array = function(value) {\n        var parts = value.split(',');\n        var res = [];\n        for (var i=0; i < parts.length; i++) {\n            if (parts[i] == '') {\n                continue;\n            }\n            res.push(fieldtransform.addslashes(parts[i]));\n        }\n        return res.join(',');\n    };\n\n    fieldtransform.integer_array = function(value) {\n        var parts = value.split(',');\n        var res = [];\n        for (var i=0; i < parts.length; i++) {\n            if (parts[i] == '') {\n                continue;\n            }\n            res.push(fieldtransform.integer(parts[i]));\n        }\n        return res.join(',');\n    };\n\n    fieldtransform.numeric_array = function(value) {\n        var parts = value.split(',');\n        var res = [];\n        for (var i=0; i < parts.length; i++) {\n            if (parts[i] == '') {\n                continue;\n            }\n            res.push(fieldtransform.numeric(parts[i]));\n        }\n        return res.join(',');\n    };\n\n    return Tableform;\n});\n"],"file":"tableform.min.js"}